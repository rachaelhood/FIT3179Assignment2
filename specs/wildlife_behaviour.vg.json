{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Behaviour composition by species",
  "width": "container",
  "height": 380,
  "data": {"url": "./data/Wildlife_Data.csv"},
  "transform": [
    {"filter": "datum.motion_type != null && datum.species != null"},
    {"aggregate": [{"op": "count", "as": "n"}], "groupby": ["species", "motion_type"]},
    {"joinaggregate": [{"op": "sum", "field": "n", "as": "total"}], "groupby": ["species"]},
    {"calculate": "datum.n / datum.total", "as": "prop"}
  ],
  "mark": "bar",
  "encoding": {
    "x": {"field": "species", "type": "nominal", "title": "Species", "sort": "-y"},
    "y": {"field": "prop", "type": "quantitative", "title": "Proportion", "axis": {"format": ".0%"}},
    "color": {"field": "motion_type", "type": "nominal", "title": "Behaviour"},
    "tooltip": [
      {"field": "species", "type": "nominal"},
      {"field": "motion_type", "type": "nominal", "title": "Behaviour"},
      {"field": "n", "type": "quantitative", "title": "Records"},
      {"field": "prop", "type": "quantitative", "title": "Share", "format": ".1%"}
    ]
  },
  "config": {"legend": {"orient": "bottom"}}
}
